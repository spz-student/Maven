package com.bdqn.spz.scott.test;

import java.util.Iterator;
import java.util.List;

import org.hibernate.*;
import org.junit.Test;

import cn.hibernatedemo.dao.HibernateUtil;
import cn.hibernatedemo.entity.DeptSalary;

public class GroupingTest {

    /**
     * æŒ‰èŒä½ç»Ÿè®¡å‘˜å·¥ä¸ªæ•°ã??
     */
    @SuppressWarnings("unchecked")
    @Test
    public void eg4() {
        Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            List<Object[]> list = HibernateUtil
                    .currentSession()
                    .createQuery(
                            "select e.job, count(e) from Emp e group by e.job")
                    .list();
            for (Object[] obj : list)
                System.out.println(obj[0] + ", " + obj[1]);
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
    }

    /**
     * ç»Ÿè®¡å„ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ?
     */
    @SuppressWarnings("unchecked")
    @Test
    public void eg5() {
        Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            List<Object[]> list = HibernateUtil
                    .currentSession()
                    .createQuery(
                            "select e.dept.deptName, avg(e.salary) from Emp e group by e.dept.deptName")
                    .list();
            for (Object[] obj : list)
                System.out.println(obj[0] + ", " + obj[1]);
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
    }

    /**
     * ç»Ÿè®¡å„ä¸ªèŒä½çš„æœ€ä½å·¥èµ„å’Œæœ?é«˜å·¥èµ?
     */
    @SuppressWarnings("unchecked")
    @Test
    public void eg6() {
        Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            List<Object[]> list = HibernateUtil
                    .currentSession()
                    .createQuery(
                            "select job,min(salary),max(salary) from Emp group by job")
                    .list();
            for (Object[] obj : list)
                System.out.println(obj[0] + ", " + obj[1] + ", " + obj[2]);
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
    }

    /**
     * ç»Ÿè®¡å„ä¸ªéƒ¨é—¨å¹³å‡å·¥èµ„é«˜äº4000å…ƒçš„éƒ¨é—¨åç§°ï¼Œæ‰“å°éƒ¨é—¨åç§°ã?éƒ¨é—¨å¹³å‡å·¥èµ?
     */
    @SuppressWarnings("unchecked")
    @Test
    public void eg7() {
        Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            List<Object[]> list = HibernateUtil
                    .currentSession()
                    .createQuery(
                            "select e.dept.deptName, avg(e.salary) from Emp e"
                                    + " group by e.dept.deptName having avg(e.salary) > 4000")
                    .list();
            for (Object[] obj : list)
                System.out.println(obj[0] + ", " + obj[1]);
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
    }

    /**
     * ç»Ÿè®¡å„ä¸ªéƒ¨é—¨å¹³å‡å·¥èµ„é«˜äº2000å…ƒçš„éƒ¨é—¨åç§°ï¼Œæ‰“å°éƒ¨é—¨åç§°ã?éƒ¨é—¨å¹³å‡å·¥èµ„ï¼Œä½¿ç”¨JavaBeanå°è£…æŸ¥è¯¢ç»“æœ
     */
    @SuppressWarnings("unchecked")
    @Test
    public void eg7_JavaBean() {
        Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            List<DeptSalary> list = HibernateUtil
                    .currentSession()
                    .createQuery(
                            "select new cn.hibernatedemo.entity.DeptSalary(" +
                                "dept.deptName, avg(salary))" +
                            " from Emp group by dept.deptName" +
                            " having avg(salary) > 2000")
                    .list();
            for (DeptSalary deptSalary : list)
                System.out.println(deptSalary.getDeptName() + ", "
                        + deptSalary.getAvgSalary());
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
    }

}
