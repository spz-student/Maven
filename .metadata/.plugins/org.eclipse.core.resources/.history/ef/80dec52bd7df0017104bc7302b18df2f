package com.bdqn.spz.scott.test;


import org.hibernate.*;
import org.junit.Test;

import cn.hibernatedemo.dao.HibernateUtil;

public class AggregationTest {

    /**
     * ç»Ÿè®¡éƒ¨é—¨ä¸ªæ•°ã€?
     */
    @Test
    public void eg_countDept() {
        Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            Long count = (Long) HibernateUtil.currentSession().createQuery(
                    "select count(id) from Dept").uniqueResult();
            System.out.println(count);
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
    }

    /**
     * ç»Ÿè®¡å‘˜å·¥å·¥èµ„æ€»å’Œã€?
     */
    @Test
    public void eg_totalSalary() {
        Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            Double salarySum = (Double) HibernateUtil.currentSession().createQuery(
                    "select sum(e.salary) from Emp e").uniqueResult();
            System.out.println(salarySum);
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
    }

    /**
     * ç»Ÿè®¡å‘˜å·¥æœ?ä½å·¥èµ„ã??
     */
    @Test
    public void eg_MinSalary() {
        Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            Double salary = (Double) HibernateUtil.currentSession().createQuery(
                    "select min(e.salary) from Emp e").uniqueResult();
            System.out.println(salary);
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
    }

    /**
     * ç»Ÿè®¡å‘˜å·¥æœ?é«˜å·¥èµ„ã??
     */
    @Test
    public void eg_MaxSalary() {
        Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            Double salary = (Double) HibernateUtil.currentSession().createQuery(
                    "select max(e.salary) from Emp e").uniqueResult();
            System.out.println(salary);
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
    }

    /**
     * ç»Ÿè®¡å‘˜å·¥å¹³å‡å·¥èµ„ã€?
     */
    @Test
    public void eg_AvgSalary() {
        Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            Double salary = (Double) HibernateUtil.currentSession().createQuery(
                    "select avg(e.salary) from Emp e").uniqueResult();
            System.out.println(salary);
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
    }

    /**
     * ç»Ÿè®¡æœ?ä½å·¥èµ„ã?æœ€é«˜å·¥èµ„ä»¥åŠå¹³å‡å·¥èµ„ã??
     */
    @Test
    public void eg_Salary() {
        Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            Object[] salarys = (Object[]) HibernateUtil.currentSession().createQuery(
                    "select min(salary), max(salary), avg(salary) from Emp")
                    .uniqueResult();
            System.out
                    .println(salarys[0] + ", " + salarys[1] + ", " + salarys[2]);
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
    }

    /**
     * åˆ¤æ–­ç»Ÿè®¡ç»“æœçš„æ•°æ®ç±»å‹ã??
     */
    @Test
    public void eg_getType() {
        Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            Object count = HibernateUtil.currentSession().createQuery(
                    "select count(distinct job) from Emp ").uniqueResult();
            System.out.println(count.getClass().getName());
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
    }

}
