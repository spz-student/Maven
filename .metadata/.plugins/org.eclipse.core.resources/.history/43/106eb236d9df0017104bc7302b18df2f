package com.bdqn.spz.scott.test;

import java.util.List;

import org.hibernate.*;
import org.junit.Test;

import cn.hibernatedemo.dao.HibernateUtil;
import cn.hibernatedemo.entity.Dept;
import cn.hibernatedemo.entity.Emp;

public class Eg {

	/**
	 * æŸ¥è¯¢å·¥èµ„é«˜äºå¹³å‡å·¥èµ„çš„å‘˜å·¥ã??
	 */
	@SuppressWarnings("unchecked")
    @Test
	public void egEmp() {
		Transaction tx = null;
		try {
			tx = HibernateUtil.currentSession().beginTransaction();
			List<Emp> list = HibernateUtil.currentSession().createQuery(
					"from Emp e where e.salary > (select avg(salary) from Emp)")
					.list();
			for (Emp emp : list) {
				System.out.println(emp.getEmpName() + ", " + emp.getSalary());
			}
			tx.commit();
		} catch (Exception e) {
			e.printStackTrace();
			if (tx != null)
			    tx.rollback();
		}
	}

	/**
	 * æŸ¥è¯¢æ‰?æœ‰å‘˜å·¥å·¥èµ„éƒ½å°äº5000çš„éƒ¨é—¨ï¼ŒåŒ…å«æ²¡æœ‰å‘˜å·¥çš„éƒ¨é—¨ã??
	 */
	@SuppressWarnings("unchecked")
    @Test
    public void eg8() {
        Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            List<Dept> list = HibernateUtil.currentSession().createQuery(
                    "from Dept d where 5000 > all(select e.salary from d.emps e)")
                .list();
            for (Dept dept : list) {
                System.out.println(dept.getDeptName());
            }
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
    }
	
	/**
	 * æŸ¥è¯¢æ‰?æœ‰å‘˜å·¥å·¥èµ„éƒ½å°äº5000çš„éƒ¨é—¨ï¼Œä¸åŒ…æ‹¬æ²¡æœ‰å‘˜å·¥çš„éƒ¨é—¨ã€?
	 */
	@SuppressWarnings("unchecked")
	@Test
	public void eg8_1() {
	    Transaction tx = null;
	    try {
	        tx = HibernateUtil.currentSession().beginTransaction();
	        List<Dept> list = HibernateUtil.currentSession().createQuery(
	                "from Dept d where 5000 > all(select e.salary from d.emps e)"
	                + " and d.emps.size > 0")
	            .list();
	        for (Dept dept : list) {
	            System.out.println(dept.getDeptName());
	        }
	        tx.commit();
	    } catch (Exception e) {
	        e.printStackTrace();
	        if (tx != null)
	            tx.rollback();
	    }
	}

	/**
	 * æŸ¥è¯¢è‡³å°‘æœ‰ä¸€ä½å‘˜å·¥å·¥èµ„ä½äº?5000çš„éƒ¨é—¨ã??
	 */
	@SuppressWarnings("unchecked")
    @Test
	public void eg9() {
	    Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            List<Dept> list = HibernateUtil.currentSession().createQuery(
                    "from Dept d where 5000 > any(select e.salary from d.emps e)")
                    .list();
			for (Dept dept : list) {
                System.out.println(dept.getDeptName());
            }
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
	}

	/**
	 * ï¼ŒæŸ¥è¯¢å‘˜å·¥å·¥èµ„æ­£å¥½æ˜¯5000å…ƒçš„éƒ¨é—¨
	 */
	@SuppressWarnings("unchecked")
    @Test
	public void eg10() {
	    Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            List<Dept> list = HibernateUtil.currentSession().createQuery(
							"from Dept d where 5000 = any(select e.salary from d.emps e)")
					.list();
			for (Dept dept : list) {
				System.out.println(dept.getDeptName());
			}
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
	}

	/**
	 * æŸ¥è¯¢å‘˜å·¥å·¥èµ„æ­£å¥½æ˜?5000å…ƒçš„éƒ¨é—¨
	 */
	@SuppressWarnings("unchecked")
    @Test
	public void eg10_1() {
	    Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            List<Dept> list = HibernateUtil.currentSession().createQuery(
							"from Dept d where 5000 = some(select e.salary from d.emps e)")
					.list();
			for (Dept dept : list) {
				System.out.println(dept.getDeptName());
			}
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
	}

	/**
	 * æŸ¥è¯¢å‘˜å·¥å·¥èµ„æ­£å¥½æ˜?5000å…ƒçš„éƒ¨é—¨
	 */
	@SuppressWarnings("unchecked")
    @Test
	public void eg10_2() {
	    Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            List<Dept> list = HibernateUtil.currentSession().createQuery(
							"from Dept d where 5000 in (select e.salary from d.emps e)")
					.list();
			for (Dept dept : list) {
				System.out.println(dept.getDeptName());
			}
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
	}

	/**
	 * æŸ¥è¯¢è‡³å°‘æœ‰ä¸€ä½å‘˜å·¥çš„éƒ¨é—¨
	 */
	@SuppressWarnings("unchecked")
    @Test
	public void eg11() {
	    Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            List<Dept> list = HibernateUtil.currentSession().createQuery(
					"from Dept d where exists (from d.emps)").list();
			for (Dept dept : list) {
				System.out.println(dept.getDeptName());
			}
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
	}

	/**
	 * æŸ¥è¯¢æŒ‡å®šå‘˜å·¥æ‰?åœ¨éƒ¨é—?
	 */
	@SuppressWarnings("unchecked")
    @Test
	public void eg12() {
	    // æ„å»ºæŸ¥è¯¢æ¡ä»¶
	    Emp emp = new Emp();
	    emp.setEmpNo(7934);
	    
	    Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            List<Dept> list = HibernateUtil.currentSession()
					.createQuery("from Dept d where ? in elements(d.emps)")
					.setParameter(0, emp).list();
			for (Dept dept : list) {
				System.out.println(dept.getDeptName());
			}
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
	}

	/**
	 * æŸ¥è¯¢æŒ‡å®šå‘˜å·¥æ‰?åœ¨éƒ¨é—?
	 */
	@SuppressWarnings("unchecked")
    @Test
	public void eg12_1() {
	    // æ„å»ºæŸ¥è¯¢æ¡ä»¶
        Emp emp = new Emp();
        emp.setEmpNo(7934);
        
        Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            List<Dept> list = HibernateUtil.currentSession()
					.createQuery("from Dept d where ? in (from d.emps)")
					.setParameter(0, emp).list();
			for (Dept dept : list) {
				System.out.println(dept.getDeptName());
			}
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
	}

	/**
	 * æŸ¥è¯¢å‘˜å·¥ä¸ªæ•°å¤§äº5çš„éƒ¨é—?
	 */
	@SuppressWarnings("unchecked")
    @Test
	public void eg13() {
	    Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            List<Dept> list = HibernateUtil.currentSession().createQuery(
					"from Dept d where d.emps.size > 5").list();
			for (Dept dept : list) {
				System.out.println(dept.getDeptName());
			}
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
	}

	/**
	 * æŸ¥è¯¢å‘˜å·¥ä¸ªæ•°å¤§äº5çš„éƒ¨é—?
	 */
	@SuppressWarnings("unchecked")
    @Test
	public void eg13_1() {
	    Transaction tx = null;
        try {
            tx = HibernateUtil.currentSession().beginTransaction();
            List<Dept> list = HibernateUtil.currentSession().createQuery(
					"from Dept d where size(d.emps) > 5").list();
			for (Dept dept : list) {
				System.out.println(dept.getDeptName());
			}
            tx.commit();
        } catch (Exception e) {
            e.printStackTrace();
            if (tx != null)
                tx.rollback();
        }
	}
}
